{% load static %}
<html>
    <head>
        <nav class="nav">
            <img src="{%static 'images/logo.png'%}" alt="Bankist logo" class="nav__logo" id="logo" />
            <ul class="nav__links">
                <li class="nav__item">
                    <a class="nav__link" href="{% url 'home' %}">Home</a>
                </li>
                <li class="nav__item">
                    <a class="nav__link" href="https://subhraneel77.github.io/Sphinx_Documentation/" target="_blank">Documentation</a>
                </li>
                <li class="nav__item">
                    <a class="nav__link" href="{% url 'simulation' %}">Simulation</a>
                </li>
                <li class="nav__item">
                    <a class="nav__link"><span style = "font-size: 1.7rem; cursor: pointer;" onclick="openNav()">Load Model</span></a>
                </li>
                <li class="nav__item">
                    <a class="nav__link" href="{% url 'visualization' %}">Visualization</a>
                </li>
                <li class="nav__item">
                    <a class="nav__link" href="{% url 'about' %}">About</a>
                </li>
                <li class="nav__item">
                    <a class="nav__link" href="{% url 'login' %}">Login</a>
                </li>
                <li class="nav__item">
                    <a href="https://github.com/DeepaMahm/differential_networks"><img src="{%static 'images/github_logo.png'%}" alt="Github logo" class="nav__logo" id="logo" /></a>
                </li>
            </ul>
        </nav>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            Visualization
        </title>
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
        <script src="https://cdn.plot.ly/plotly-1.58.5.min.js"></script>
        <style>
            .graph-container {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
            }
            .main-panel {
                width: 100%;
                height: 800px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
            .side-panel {
                position: fixed;
                top: 0px;
                bottom: 0;
                right: -300px;
                width: 300px;
                background-color: red;
                transition: right 0.5s;
                overflow-y: auto;
                padding: 20px;
		    }
           
            .side-panel.open {
                right: 0;
		    }

            .arrow {
                position: absolute;
                top: 20px;
                left: 20px;
                width: 0;
                height: 0;
                border-top: 20px solid transparent;
                border-bottom: 20px solid transparent;
                border-right: 20px solid #2196F3;
                cursor: pointer;
		    }

            .arrow.open {
                transform: rotate(180deg);
            }

            {# Added Code for side bar  #}

            .sidenav {
              height: 100%;
              width: 0;
              position: fixed;
              z-index: 3;
              top: 80px;
              left: 0;
              background-color: #111;
              overflow-x: hidden;
              transition: 0.5s;
              padding-top: 60px;
            }

            .sidenav a {
              padding: 8px 8px 8px 32px;
              text-decoration: none;
              font-size: 25px;
              color: #818181;
              display: block;
              transition: 0.3s;
            }

            .sidenav a:hover {
              color: #f1f1f1;
            }

            .sidenav .closebtn {
              position: absolute;
              top: 0;
              right: 25px;
              font-size: 36px;
              margin-left: 50px;
            }

            #main {
                transition: margin-left .5s;
                padding: 16px;
            }

            .form {
                border-radius: 20px;
                box-sizing: border-box;
                height: 500px;
                padding: 20px;
                width: inherit;
                font-size: 1.8rem;
            }

            .title{
                color: #eee;
                font-family: "Bitstream Vera Sans Mono", Monaco, "Courier New", Courier, monospace;
                font-size: 25px;
                font-weight: 400;
                padding-left: 15px;
                margin-top: 15px;
            }


            .input-container {
                height: 50px;
                position: relative;
                width: 100%;
            }

            .soura {
              margin-top: 40px;
            }

            .ic2 {
              margin-top: 30px;
            }

            .input {
              background-color: #303245;
              border-radius: 12px;
              border: 0;
              box-sizing: border-box;
              color: #eee;
              font-size: 18px;
              height: 100%;
              outline: 0;
              padding: 4px 20px 0;
              width: 100%;
            }

            .cut {
              background-color: black;
              border-radius: 10px;
              height: 20px;
              left: 20px;
              position: absolute;
              top: -20px;
              transform: translateY(0);
              transition: transform 200ms;

            }

            .arrowsize-cut{
                width: 80px;
            }

            .concentration-cut{
                width: 105px;
            }

            .example-cut{
                width: 140px;
            }

            .labelsize-cut{
                width: 80px;
            }

            .input:focus ~ .cut,
            .input:not(:placeholder-shown) ~ .cut {
              transform: translateY(8px);
            }

            .placeholder {
              color: #65657b;
              font-family: sans-serif;
              left: 20px;
              line-height: 14px;
              pointer-events: none;
              position: absolute;
              transform-origin: 0 50%;
              transition: transform 200ms, color 200ms;
              top: 20px;
            }

            .input:focus ~ .placeholder,
            .input:not(:placeholder-shown) ~ .placeholder {
              transform: translateY(-30px) translateX(10px) scale(0.75);
            }

            .input:not(:placeholder-shown) ~ .placeholder {
              color: #808097;
            }

            .input:focus ~ .placeholder {
              color: #dc2f55;
            }

            .submit {
              background-color: #08d;
              border-radius: 12px;
              border: 0;
              box-sizing: border-box;
              color: #eee;
              cursor: pointer;
              font-size: 18px;
              height: 50px;
              margin-top: 38px;
              outline: 0;
              text-align: center;
              width: 100%;
            }

            .submit:active {
              background-color: #06b;
            }





            /* Adding the button */

            @media screen and (max-height: 450px) {
              .sidenav {padding-top: 15px;}
              .sidenav a {font-size: 18px;}
            }
        </style>

    </head>
    <body>
        <!-- Code written by sourasish -->
        <div id = "main">
        <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                <div class="form">
                    <div class = "title"> Load a Model</div>
                  <div class="input-container soura">
                      <input id="examples" class="input" type="text" placeholder=" " />
                      <div class="cut example-cut"></div>
                      <label for="examples" class="placeholder">Examples #1 #2 #3</label>
                  </div>
                  <div class="input-container ic2">
                      <input id="concentration" class="input" type="text" placeholder=" " />
                      <div class="cut concentration-cut"></div>
                      <label for="concentration" class="placeholder">Concentration</label>
                  </div>
                  <div class="input-container ic2">
                      <input id="arrowsize" class="input" type="text" placeholder=" " />
                      <div class="cut arrowsize-cut"></div>
                      <label for="arrowsize" class="placeholder">Arrow Size</label>
                  </div>
                    <div class="input-container ic2">
                      <input id="labelsize" class="input" type="text" placeholder=" " />
                      <div class="cut labelsize-cut"></div>
                      <label for="labelsize" class="placeholder">Label Size</label>
                    </div>
                  <button type="text" class="submit">Submit</button>
                </div>
            <a href = "#">Download</a>
        </div>





        <div class="graph-container">
            <div id="network" class="main-panel"></div>
            <div id="graph" class="side-panel">
                <div class="arrow"></div>

            </div>
        </div>



        <div id="soura">
{#            <button class="openbtn" onclick="openNav()">â˜° Open Sidebar</button>#}

        </div>


        <script>

            /* function openNav() {
                document.getElementById("graph").style.width = "500px";
                document.getElementById("main").style.marginLeft = "500px";
            }
            function closeNav() {
                document.getElementById("graph").style.width = "0";
                document.getElementById("main").style.marginLeft= "0";
            }

            const sidepanel = document.querySelector('.side-panel');
            const arrow = document.querySelector('.arrow');

            arrow.addEventListener('click', function() {
			sidepanel.classList.toggle('open');
			arrow.classList.toggle('open');
		}); */

            function openNav() {
                document.getElementById("mySidenav").style.width = "250px";
                document.getElementById("main").style.marginLeft = "250px";
            }

            function closeNav() {
                document.getElementById("mySidenav").style.width = "0";
                document.getElementById("main").style.marginLeft = "0";
            }

            //read the data from the json file
            fetch("/results/")
                .then(response => response.json())
                .then( data => {
                    //This part of the code is used to used initialize the variables which will be used to create a network graph

                    //Initializing array for storing the variables
                    var nnodes = data.nnodes;
                    var nedges = data.nedges;
                    var ncones = data.ncones;
                    var x = data.x;
                    var y = data.y;
                    var z = data.z;
                    var edge_x = data.edge_x;
                    var edge_y = data.edge_y;
                    var edge_z = data.edge_z;
                    var pressure_edge_gradient = data.pressure_gradient;

                    console.log(data)
                    // Velocity and the max and min values of the velocity
                    var velocity = data.velocity;
                    var max_velocity = data.max_velocity;
                    var min_velocity = data.min_velocity;

                    //This part of code is used to initialize the variables which will be used to create cones
                    var x_cone = data.x_cone;
                    var y_cone = data.y_cone;
                    var z_cone = data.z_cone;
                    var u_cone = data.u_cone;
                    var v_cone = data.v_cone;
                    var w_cone = data.w_cone;
                    console.log(x_cone[0])

                    //Keeping a list of true and false values for the concentration and the cones which are used while displaying through layout
                    var TrueList_cones = [];
                    var FalseList_cones = [];
                    for (var i = 0; i < ncones; i++) {
                        TrueList_cones.push(true);
                        FalseList_cones.push(false);
                    };

                    //This part of the code is used to create a pressure graph
                    //Creating Edges for pressure graph
                    var pressure_trace_edges = {
                        x: edge_x,
                        y: edge_y,
                        z: edge_z,
                        mode: 'lines',
                        line: {
                            colorscale: "YlOrRd",
                            color: pressure_edge_gradient,
                            width: 5,
                            showscale: true,
                            //decrease the size of the colorbar
                            colorbar: {
                                thickness: 20,
                                len: 0.5,
                                x: 0.9,
                                y: 0.5,
                                title: {
                                    text: "Pressure",
                                    side: "right"
                                }
                            }
                        },
                        type: 'scatter3d',
                        name: "Pressure Edges",
                        hoverinfo: 'none',
                        visible: true,
                        showlegend: true,
                        
                        //set the position of the legend
                    };

                    //This part of the code is used to create a velocity graph
                    //Creating nodes for velocity graph
                    var velocity_trace_nodes = {
                        x: x,
                        y: y,
                        z: z,
                        mode: 'markers',
                        marker: {
                            size: Array(nnodes).fill(6),
                            sizeref: 0.5, 
                            color: "rgb(200,200,200))",
                            showscale: false,
                        },
                        type: 'scatter3d',
                        name: "Velocity Nodes",
                        hoverinfo: 'none',
                        visible: false,
                        showlegend: false,
                    };

                    //Creating edges for velocity graph
                    var velocity_trace_edges = {
                        x: edge_x,
                        y: edge_y,
                        z: edge_z,
                        mode: 'lines',
                        line: {
                            color: "rgb(200,200,200)",
                            width: 5,
                            showscale: true,
                        },
                        type: 'scatter3d',
                        name: "Velocity Edges",
                        hoverinfo: 'none',
                        showlegend: false,
                        visible: false,
                        showscale: false,
                        
                    };

                    //Creating cones for velocity graph
                    var velocity_trace_cones =[];

                    for (var i = 0;i < ncones ;i++){
                        
                        var coneColor = velocity[i];
                        var color = 'rgb(' + (coneColor-min_velocity)*255/(max_velocity-min_velocity) + ', 0, ' + (max_velocity-coneColor)*255/(max_velocity-min_velocity) + ')'; // create the color based on the velocity
                        var coneColorScale = [[0, color], [1, color]];

                        var single_cone = {
                            x: [x_cone[i]],
                            y: [y_cone[i]],
                            z: [z_cone[i]],
                            u: [u_cone[i]],
                            v: [v_cone[i]],
                            w: [w_cone[i]],
                            type: 'cone',
                            sizemode: 'absolute',
                            sizeref: 5.2,
                            anchor: 'tail',
                            colorscale: coneColorScale,
                            // color: 'red',
                            showscale: false,
                            name: 'Velocity Cones',
                            hoverinfo: 'none',
                            visible: false,
                        };
                        velocity_trace_cones.push(single_cone);
                    };
                    console.log(velocity_trace_cones)
                    var data = [pressure_trace_edges, velocity_trace_nodes,velocity_trace_edges, ...velocity_trace_cones];

                    //creating a list for dummy nodes for concentration nodes
                    var layout = {
                        updatemenus: [
                            {
                                x: 0.1, //dont change this value, if needed do minute changes like 0.1 wise - drop down button x axis
                                y: 0.950,   //dont change this value, if needed, do minute changes like 0.1 wise - drop down button y axis (keep it close to load button value so that both of them are at the same level)
                                yanchor: "top",
                                xanchor: "left",
                                showactive: true,
                                pad: [
                                    {
                                        r: 2,
                                        t: 2
                                    }
                                ],
                                direction: "down",
                                height: 1000,
                                width: 8000,
                                buttons: [
                                    {
                                        method: "restyle",
                                        args: ["visible", [false,true,true,...TrueList_cones]], //using velocity graph. Change to Example
                                        label: "Example"

                                    },
                                    {
                                        method: "restyle",
                                        args: ["visible", [true,false,false,...FalseList_cones]],
                                        label: "Pressure"
                                    },
                                    {
                                        method: "restyle",
                                        args: ["visible", [false,true,true,...TrueList_cones]],
                                        label: "Velocity"
                                    },
                                    {
                                        method: "restyle",
                                        args: ["visible", [false,true,true,...TrueList_cones]], //using velocity graph. Change to Concentration
                                        label: "Concentration"
                                    },
                                    {
                                        method: "restyle",
                                        args: ["visible", [false,true,true,...TrueList_cones]], //using velocity graph. Change to Arrow Size
                                        label: "Arrow Size"
                                    },
                                    {
                                        method: "restyle",
                                        args: ["visible", [false,true,true,...TrueList_cones]], //using velocity graph. Change to Label Size
                                        label: "Label Size"
                                    },
                                    {
                                        method: "restyle",
                                        args: ["visible", [false,true,true,...TrueList_cones]], //using velocity graph. Change to Download
                                        label: "Download"
                                    },
                                ],

                            },
                            
                        ],
                        /* This is for adding the Load Button text beside the drop-down menu */

                        //code by Sourasish
                        annotations: [
                            {
                                text: "Load Button:",
                                showarrow: false,
                                x: 0.025,     //dont change this value, if needed do minute changes like 0.1 wise - load button x axis nahole alignment thakbe na
                                y: 0.939,    //dont change this value, if needed do minute changes like 0.1 wise - Load button y axis nahole alignment thakbe na
                                xref: "paper",
                                yref: "paper",
                                align: "left"
                            }
                        ],

                        //for changing the 2D view
                        xaxis: {
                            visible: false,
                            showgrid: false,
                        },
                        yaxis: {
                            visible: false,
                            showgrid: false,
                        },
                        zaxis: {
                            visible: false,
                            showgrid: false,
                        }

                    };
                    Plotly.newPlot('network', data, layout);
                })
        </script>
        </div>
    </body>
</html>